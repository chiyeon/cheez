#ifndef SEARCH_H
#define SEARCH_H

#include "game.h"

class Search
{
   constexpr static int piece_values[7] = {
      0,
      10,
      30,
      32,
      45,
      90,
      2000
   };

   constexpr static int MVV_LVA_table[8][8] = {
      {0, 0, 0, 0, 0, 0, 0},       // victim K, attacker K, Q, R, B, N, P, None
      {50, 51, 52, 53, 54, 55, 0}, // victim Q, attacker K, Q, R, B, N, P, None
      {40, 41, 42, 43, 44, 45, 0}, // victim R, attacker K, Q, R, B, N, P, None
      {30, 31, 32, 33, 34, 35, 0}, // victim B, attacker K, Q, R, B, N, P, None
      {20, 21, 22, 23, 24, 25, 0}, // victim N, attacker K, Q, R, B, N, P, None
      {10, 11, 12, 13, 14, 15, 0}, // victim P, attacker K, Q, R, B, N, P, None
      {0, 0, 0, 0, 0, 0, }
   };

   constexpr static float black_pawn_table[64] = {
      0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
      5.0,  6.0,  5.0,  5.0,  5.0,  6.0,  5.0,  5.0,
      1.0,  1.0,  2.0,  3.0,  3.0,  2.0,  1.0,  1.0,
      0.5,  0.5,  1.0,  2.5,  2.5,  1.0,  0.5,  0.5,
      0.0,  0.0,  0.0,  2.0,  2.0,  0.0,  0.0,  0.0,
      0.5, -0.5, -1.0,  0.0,  0.0, -1.0, -0.5,  0.5,
      -2,  1.0, -1.0,  -3.0, -2.0,  1.0,  1.0,  -1,
      0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0
   };

   constexpr static float black_knight_table[64] = {
      -5.0, -4.0, -3.0, -3.0, -3.0, -3.0, -4.0, -5.0,
      -4.0, -2.0,  0.0,  0.0,  0.0,  0.0, -2.0, -4.0,
      -3.0,  0.0,  1.0,  1.5,  1.5,  1.0,  0.0, -3.0,
      -3.0,  0.5,  1.5,  2.0,  2.0,  1.5,  0.5, -3.0,
      -3.0,  0.0,  1.5,  2.0,  2.0,  1.5,  0.0, -3.0,
      -3.0,  0.5,  1.0,  1.5,  1.5,  1.0,  0.5, -3.0,
      -4.0, -2.0,  0.0,  0.5,  0.5,  0.0, -2.0, -4.0,
      -5.0, -4.0, -3.0, -3.0, -3.0, -3.0, -4.0, -5.0
   };

   constexpr static float black_bishop_table[64] = {
      -2.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -2.0,
      -1.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0, -1.0,
      -1.0,  0.0,  0.5,  1.0,  1.0,  0.5,  0.0, -1.0,
      -1.0,  0.5,  0.5,  1.0,  1.0,  0.5,  0.5, -1.0,
      -1.0,  0.0,  1.0,  1.0,  1.0,  1.0,  0.0, -1.0,
      -1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0, -1.0,
      -1.0,  0.5,  0.0,  0.0,  0.0,  0.0,  0.5, -1.0,
      -2.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -2.0
   };

   constexpr static float black_rook_table[64] = {
      0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
       0.5,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  0.5,
      -0.5,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0, -0.5,
      -0.5,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0, -0.5,
      -0.5,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0, -0.5,
      -0.5,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0, -0.5,
      -0.5,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0, -0.5,
       0.0,   0.0, 0.0,  0.5,  0.5,  0.0,  0.0,  0.0
   };

   constexpr static float black_queen_table[64] = {
      -2.0, -1.0, -1.0, -0.5, -0.5, -1.0, -1.0, -2.0,
      -1.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0, -1.0,
      -1.0,  0.0,  0.5,  0.5,  0.5,  0.5,  0.0, -1.0,
      -0.5,  0.0,  0.5,  0.5,  0.5,  0.5,  0.0, -0.5,
       0.0,  0.0,  0.5,  0.5,  0.5,  0.5,  0.0, -0.5,
      -1.0,  0.5,  0.5,  0.5,  0.5,  0.5,  0.0, -1.0,
      -1.0,  0.0,  0.5,  0.0,  0.0,  0.0,  0.0, -1.0,
      -2.0, -1.0, -1.0, -0.5, -0.5, -1.0, -1.0, -2.0
   };

   constexpr static float black_king_table[64] = {
      -3.0, -4.0, -4.0, -5.0, -5.0, -4.0, -4.0, -3.0,
      -3.0, -4.0, -4.0, -5.0, -5.0, -4.0, -4.0, -3.0,
      -3.0, -4.0, -4.0, -5.0, -5.0, -4.0, -4.0, -3.0,
      -3.0, -4.0, -4.0, -5.0, -5.0, -4.0, -4.0, -3.0,
      -2.0, -3.0, -3.0, -4.0, -4.0, -3.0, -3.0, -2.0,
      -1.0, -2.0, -2.0, -2.0, -2.0, -2.0, -2.0, -1.0,
       2.0,  2.0,  0.0,  0.0,  0.0,  0.0,  2.0,  2.0,
       2.0,  3.0,  1.0,  0.0,  0.0,  1.0,  3.0,  2.0 
   };

   constexpr static float white_pawn_table[64] = {
      0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
      -2,  1.0, -1.0,  -3.0, -2.0,  1.0,  1.0,  -1,
      0.5, -0.5, -1.0,  0.0,  0.0, -1.0, -0.5,  0.5,
      0.0,  0.0,  0.0,  2.0,  2.0,  0.0,  0.0,  0.0,
      0.5,  0.5,  1.0,  2.5,  2.5,  1.0,  0.5,  0.5,
      1.0,  1.0,  2.0,  3.0,  3.0,  2.0,  1.0,  1.0,
      5.0,  6.0,  5.0,  5.0,  5.0,  6.0,  5.0,  5.0,
      0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
   };

   constexpr static float white_knight_table[64] = {
      -5.0, -4.0, -3.0, -3.0, -3.0, -3.0, -4.0, -5.0,
      -4.0, -2.0,  0.0,  0.5,  0.5,  0.0, -2.0, -4.0,
      -3.0,  0.5,  1.0,  1.5,  1.5,  1.0,  0.5, -3.0,
      -3.0,  0.0,  1.5,  2.0,  2.0,  1.5,  0.0, -3.0,
      -3.0,  0.5,  1.5,  2.0,  2.0,  1.5,  0.5, -3.0,
      -3.0,  0.0,  1.0,  1.5,  1.5,  1.0,  0.0, -3.0,
      -4.0, -2.0,  0.0,  0.0,  0.0,  0.0, -2.0, -4.0,
      -5.0, -4.0, -3.0, -3.0, -3.0, -3.0, -4.0, -5.0,
   };

   constexpr static float white_bishop_table[64] = {
      -2.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -2.0,
      -1.0,  0.5,  0.0,  0.0,  0.0,  0.0,  0.5, -1.0,
      -1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0, -1.0,
      -1.0,  0.0,  1.0,  1.0,  1.0,  1.0,  0.0, -1.0,
      -1.0,  0.5,  0.5,  1.0,  1.0,  0.5,  0.5, -1.0,
      -1.0,  0.0,  0.5,  1.0,  1.0,  0.5,  0.0, -1.0,
      -1.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0, -1.0,
      -2.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -2.0,
   };

   constexpr static float white_rook_table[64] = {
       0.0,   0.0, 0.0,  0.5,  0.5,  0.0,  0.0,  0.0,
      -0.5,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0, -0.5,
      -0.5,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0, -0.5,
      -0.5,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0, -0.5,
      -0.5,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0, -0.5,
      -0.5,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0, -0.5,
       0.5,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  0.5,
      0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
   };

   constexpr static float white_queen_table[64] = {
      -2.0, -1.0, -1.0, -0.5, -0.5, -1.0, -1.0, -2.0,
      -1.0,  0.0,  0.5,  0.0,  0.0,  0.0,  0.0, -1.0,
      -1.0,  0.5,  0.5,  0.5,  0.5,  0.5,  0.0, -1.0,
       0.0,  0.0,  0.5,  0.5,  0.5,  0.5,  0.0, -0.5,
      -0.5,  0.0,  0.5,  0.5,  0.5,  0.5,  0.0, -0.5,
      -1.0,  0.0,  0.5,  0.5,  0.5,  0.5,  0.0, -1.0,
      -1.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0, -1.0,
      -2.0, -1.0, -1.0, -0.5, -0.5, -1.0, -1.0, -2.0,
   };

   constexpr static float white_king_table[64] = {
       2.0,  3.0,  1.0,  0.0,  0.0,  1.0,  3.0,  2.0,
       2.0,  2.0,  0.0,  0.0,  0.0,  0.0,  2.0,  2.0,
      -1.0, -2.0, -2.0, -2.0, -2.0, -2.0, -2.0, -1.0,
      -2.0, -3.0, -3.0, -4.0, -4.0, -3.0, -3.0, -2.0,
      -3.0, -4.0, -4.0, -5.0, -5.0, -4.0, -4.0, -3.0,
      -3.0, -4.0, -4.0, -5.0, -5.0, -4.0, -4.0, -3.0,
      -3.0, -4.0, -4.0, -5.0, -5.0, -4.0, -4.0, -3.0,
      -3.0, -4.0, -4.0, -5.0, -5.0, -4.0, -4.0, -3.0,
   };

   Game & game;
   int alphabeta(int depth, int alpha, int beta, bool maximizing_player);
   int num_positions_evaluated = 0;

   std::vector<int> get_move_scores(const std::vector<Move> & moves);
   void swap(std::vector<int> vec, int i, int j);

public:
   Search(Game & game);
   float evaluate_position();
   Move get_best_move(int depth);
   int get_num_positions_evaluated();
};

#endif